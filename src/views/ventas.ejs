<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ventas</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/styles.css" rel="stylesheet">
</head>
<body>
  <div>
    <h1>Ventas</h1>
    <a type="button" class="btn btn-info" href="/">Volver al inicio</a>

    <form action="/api/ventas" method="POST" id="form-ventas" class="p-3">
  <!-- Información general de la venta -->
  <div class="mb-3">
    <label for="fecha" class="form-label">Fecha</label>
    <input type="datetime-local" id="fecha" name="fecha" class="form-control">
  </div>

  <div class="mb-3">
    <label for="total" class="form-label">Total</label>
    <input type="number" id="total" name="total" class="form-control" placeholder="0.00" min="0" step="0.01" readonly>
  </div>

  <!-- Detalles de la venta -->
  <div class="mb-3">
    <div class="d-flex justify-content-between align-items-center mb-2">
      <h5 class="mb-0">Detalles de la Venta</h5>
      <button type="button" id="agregar-detalle" class="btn btn-sm btn-success">
        Agregar Producto
      </button>
    </div>

    <div id="detalles-container" class="mb-2">
      <!-- Los detalles se agregarán dinámicamente aquí -->
    </div>


  </div>

  <!-- Botón de envío -->
  <div class="d-grid">
    <button type="submit" id="btn-crear-venta" class="btn btn-primary" disabled>
      Crear Venta
    </button>
  </div>
</form>

    
    <!-- Script para pasar datos de productos al JavaScript -->
    <script>
      window.productos = <%- JSON.stringify(productos) %>;
    </script>
    <script src="/js/form-venta.js"></script>
    
    <table class="table table-success">
      <thead>
        <tr>
          <th>ID</th>
          <th>Fecha</th>
          <th>Total</th>
          <th></th>
        </tr>
      </thead>
      <tbody id="tabla-ventas">
        <% if (ventas && ventas.length) { %>
          <% ventas.forEach(venta => { %>
            <tr data-id="<%= venta.id %>">
              <td><%= venta.id %></td>
              <td><%= venta.fecha ? new Date(venta.fecha).toLocaleString() : '' %></td>
              <td><%= venta.total %></td>
              <td>
                <button type="button" class="eliminar-venta">Eliminar</button>
              </td>
            </tr>
          <% }) %>
        <% } else { %>
          <tr><td colspan="4">No hay ventas</td></tr>
        <% } %>
      </tbody>
    </table>
    <script src="/js/ventas.js"></script>
  </div>

</body>
</html>
