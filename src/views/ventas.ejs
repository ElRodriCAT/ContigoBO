<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ventas</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/styles.css" rel="stylesheet">
</head>
<body>
  <div>
    <h1>Ventas</h1>
    <a type="button" class="btn btn-info" href="/">Volver al inicio</a>

    <form action="/api/ventas" method="POST" id="form-venta">
      <!-- Información general de la venta -->
      <div>
        <div>
          <label>Fecha</label>
          <input type="datetime-local" name="fecha">
        </div>
        <div>
          <label>Total</label>
          <input type="number" name="total" placeholder="0.00" min="0" step="0.01" readonly>
        </div>
      </div>

      <!-- Detalles de la venta -->
      <div>
        <div>
          <h5>Detalles de la Venta</h5>
          <button type="button" id="agregar-detalle">
            Agregar Producto
          </button>
        </div>
        <div>
          <div id="detalles-container">
            <!-- Los detalles se agregarán dinámicamente aquí -->
          </div>
          <div id="no-detalles">
            No hay productos agregados. Haz clic en "Agregar Producto" para empezar.
          </div>
        </div>
      </div>

      <!-- Botón de envío -->
      <div>
        <div>
          <button type="submit" id="btn-crear-venta" disabled>
            Crear Venta
          </button>
        </div>
      </div>
    </form>
    
    <!-- Script para pasar datos de productos al JavaScript -->
    <script>
      window.productos = <%- JSON.stringify(productos) %>;
    </script>
    <script src="/js/form-venta.js"></script>
    
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Total</th>
          <th>Fecha</th>
          <th></th>
        </tr>
      </thead>
      <tbody id="tabla-ventas">
        <% if (ventas && ventas.length) { %>
          <% ventas.forEach(venta => { %>
            <tr data-id="<%= venta.id %>">
              <td><%= venta.id %></td>
              <td><%= venta.total %></td>
              <td><%= venta.fecha ? new Date(venta.fecha).toLocaleString() : '' %></td>
              <td>
                <button type="button" class="eliminar-venta">Eliminar</button>
              </td>
            </tr>
          <% }) %>
        <% } else { %>
          <tr><td colspan="4">No hay ventas</td></tr>
        <% } %>
      </tbody>
    </table>
    <script src="/js/ventas.js"></script>
  </div>

</body>
</html>
